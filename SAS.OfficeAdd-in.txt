Private Sub Workbook_Open()
   On Error Resume Next
    'Reference SAS Office Add-in Object Library using Major / Minor GUID
    Set ID = ThisWorkbook.VBProject.References
    ID.AddFromGuid "{9E9CE404-E32F-4DEC-BC01-292916642B95}", 7, 100
End Sub

Private Sub LoopThroughFiles()

Dim directory As String, fileName As String, ws As Worksheet
Application.ScreenUpdating = False
Dim sas As SASExcelAddIn
Dim data As SASDataView

Set sas = Application.COMAddIns.Item("SAS.ExcelAddIn").Object

sas.Options.ResetAll
sas.Options.AutomaticallyCheckForUpdates = True

sas.Options.Excel.DataFormatting = ExcelDataFormatting_Automatic
'sas.Options.Excel.OutputDatasetRecordsToDisplay = 1048575
sas.Options.Excel.OutputDatasetShowInfoInWorksheet = False
sas.Options.Excel.OutputDatasetShowRowNumbers = False
sas.Options.UseVariableLabels = False
    
directory = "C:\Users\kcb505"
fileName = Dir(directory & "*.sas7bdat")

Do While fileName <> ""
Set ws = ThisWorkbook.Sheets.Add(Before:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))

  LArray = Split(fileName, ".")
  ws.Name = LArray(0)

  Set data = sas.InsertDataFromLocalMachine(directory & fileName, ws.Range("A1"), , True, , , False)
  fileName = Dir()
Loop

sas.Options.ResetAll

End Sub


Public Function CreateReport()
Call Workbook_Open
Call LoopThroughFiles
End Function
